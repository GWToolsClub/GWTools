% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tsbw_gwglm.R
\name{tsbw_gwglm}
\alias{tsbw_gwglm}
\title{Two-Stage Bandwidth Selection for Geographically Weighted Generalized Linear Model (GWGLM)}
\usage{
tsbw_gwglm(
  formula,
  family,
  cordxy,
  distmethod = "euclidean",
  kernel,
  adaptive = TRUE,
  criterion,
  offset = NULL,
  local_var,
  global_var,
  data,
  bw_min = NA,
  bw_max = NA,
  parallel = TRUE,
  core = NULL
)
}
\arguments{
\item{formula}{A formula object specifying the model structure (response ~ predictors).}

\item{family}{A character string specifying the distribution family. Supported options are \code{"gaussian"}, \code{"poisson"}, and \code{"binomial"}.}

\item{cordxy}{A matrix of spatial coordinates, with columns representing X and Y.}

\item{distmethod}{A character string indicating the distance calculation method to use.
Supported options are \code{"euclidean"} (default), \code{"greatcircle"} (great-circle distance), and \code{"manhattan"} (city-block distance).}

\item{kernel}{A character string specifying the kernel function used to compute spatial weights.
Options are \code{"global"}, \code{"gaussian"}, \code{"exponential"}, \code{"bisquare"}, \code{"tricube"}, and \code{"boxcar"}.}

\item{adaptive}{Logical. If \code{TRUE} (default), uses adaptive bandwidth. If \code{FALSE}, uses fixed bandwidth.}

\item{criterion}{A character string specifying the bandwidth selection criterion. Options are \code{"CV"} (cross-validation) and \code{"AIC"} (AICc).}

\item{offset}{A character string giving the name of a column in the data to be used as offset (optional). If not provided, only the internal offset from fixed coefficients is used.}

\item{local_var}{A character vector of variable names to be treated as spatially varying (local) coefficients.}

\item{global_var}{A character vector of variable names to be treated as spatially invariant (global) coefficients.}

\item{data}{A data frame containing all variables used in the model.}

\item{bw_min}{Minimum bandwidth value for both stages.
If \code{NA} (default), it is automatically set to the 10th percentile of non-zero distances (for fixed bandwidth) or 10\% of the number of observations (for adaptive bandwidth).}

\item{bw_max}{Maximum bandwidth value for both stages.
If \code{NA} (default), it is automatically set to the 90th percentile of non-zero distances (for fixed bandwidth) or 90\% of the number of observations (for adaptive bandwidth).}

\item{parallel}{Logical. If \code{TRUE} (default), enables parallel computation during bandwidth search.}

\item{core}{Integer. The number of CPU cores to use when \code{parallel = TRUE}.
If \code{NULL}, the number of cores is set to the total number of detected cores minus 2.}
}
\value{
A list with two elements:
\itemize{
\item \code{h1}: The selected bandwidth for the first stage.
\item \code{h2}: The selected bandwidth for the second stage.
}
}
\description{
This function implements a two-stage bandwidth selection procedure for GWGLM, where the bandwidth at each stage is selected
based on either cross-validation (CV) or corrected Akaike Information Criterion (AICc).
The function first estimates a global model and selects the optimal bandwidth using either cross-validation (CV) or AICc.
The resulting coefficients are used to construct an offset term for the second stage, where the local bandwidth is chosen.
}
\details{
In addition to standard binary response variables of numeric \code{0/1} type,
this function and the associated GWGLM series uniquely support proportion-type responses
expressed as success counts and total trials (e.g., \code{y/n}).

When success/trial matrices are provided, the function automatically computes the success proportions internally,
eliminating the need for manual preprocessing.

This feature broadens the flexibility of modeling binary and proportion data,
addressing a common limitation in existing geographically weighted modeling packages.
}
\examples{
\dontrun{
data(tokyo)

tokyo$lnoff = log(tokyo$Exp_2564)

cordxy <- cbind(tokyo$X, tokyo$Y)
formula <- Mort2564~Professl+OwnHome+Elderly+Unemply+offset(lnoff)
family <- "poisson"
offset <- "lnoff"
local_var <- c("Professl","Unemply")
global_var <- c("(Intercept)","OwnHome","Elderly")

ts_bw_cv <- tsbw_gwglm(
  formula = formula,
  family = family,
  cordxy = cordxy,
  kernel = "gaussian",
  adaptive = FALSE,
  criterion = "CV",
  offset = offset,
  local_var = local_var,
  global_var = global_var,
  data = tokyo,
  parallel = TRUE
)
ts_bw_cv

ts_bw_aic <- tsbw_gwglm(
  formula = formula,
  family = family,
  cordxy = cordxy,
  kernel = "gaussian",
  adaptive = FALSE,
  criterion = "AIC",
  offset = offset,
  local_var = local_var,
  global_var = global_var,
  data = tokyo,
  parallel = TRUE
)
ts_bw_aic
}
}
\references{
Li, D. and Mei, C. (2018). A two-stage estimation method with bootstrap inference for semi-parametric geographically weighted generalized linear models.
International Journal of Geographical Information Science, 32(9):1860â€“1883.

Zheng, G.-T. (2024). \emph{An application of semi-parametric geographically weighted logistic regression in real estate transaction data analysis}.
Master's thesis, Department of Statistics, National Chengchi University, Taiwan.
}
