% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/TSGWML.R
\name{TSGWML}
\alias{TSGWML}
\title{Two-Stage Geographically Weighted Maximum Likelihood (TSGWML)}
\usage{
TSGWML(
  formula,
  family,
  cordxy,
  distmethod = "euclidean",
  kernel,
  adaptive = TRUE,
  h1,
  h2,
  offset = NULL,
  local_var,
  global_var,
  data,
  parallel = TRUE,
  core = NULL
)
}
\arguments{
\item{formula}{A formula object specifying the model structure (response ~ predictors).}

\item{family}{A character string specifying the distribution family. Supported options are \code{"gaussian"}, \code{"poisson"}, and \code{"binomial"}.}

\item{cordxy}{A matrix of spatial coordinates, with columns representing X and Y.}

\item{distmethod}{A character string indicating the distance calculation method to use.
Supported options are \code{"euclidean"} (default), \code{"greatcircle"} (great-circle distance), and \code{"manhattan"} (city-block distance).}

\item{kernel}{A character string specifying the kernel function used to compute spatial weights.
Options are \code{"global"}, \code{"gaussian"}, \code{"exponential"}, \code{"bisquare"}, \code{"tricube"}, and \code{"boxcar"}.}

\item{adaptive}{Logical. If \code{TRUE} (default), uses adaptive bandwidth. If \code{FALSE}, uses fixed bandwidth.}

\item{h1}{Numeric. Bandwidth used in the first-stage global fitting.}

\item{h2}{Numeric. Bandwidth used in the second-stage local fitting.}

\item{offset}{A character string giving the name of a column in the data to be used as offset (optional).
If not provided, only the internal offset from fixed coefficients is used.}

\item{local_var}{A character vector of variable names to be treated as spatially varying (local) coefficients.}

\item{global_var}{A character vector of variable names to be treated as spatially invariant (global) coefficients.}

\item{data}{A data frame containing all variables used in the model.}

\item{parallel}{Logical. If \code{TRUE} (default), enables parallel computing for faster estimation. Default is \code{TRUE}.}

\item{core}{Integer. The number of CPU cores to use when \code{parallel = TRUE}.
If \code{NULL}, the number of cores is set to the total number of detected cores minus 2.}
}
\value{
A list of class \code{"TSGWML_model"} containing:
\describe{
\item{\code{formula}}{The formula used in the first stage.}
\item{\code{muhat}}{Fitted values from the second stage model.}
\item{\code{global_beta}}{A matrix of global (fixed) coefficients.}
\item{\code{local_beta}}{A matrix of local (spatially varying) coefficients.}
\item{\code{LRT_statistic}}{The log-likelihood ratio (LRT) statistic computed as the difference between the first-stage (global-only) and second-stage (local+global) models.}
\item{\code{new_data}}{A data frame combining the original input data with estimated global coefficients, local coefficients, and corresponding standard errors, t-values, and p-values.}
\item{\code{call}}{The matched function call.}
}
}
\description{
Fits a Two-Stage Geographically Weighted Maximum Likelihood (TSGWML) model that separates
global (fixed) and local (spatially varying) variables into two sequential estimation stages.
}
\details{
In addition to standard binary response variables of numeric \code{0/1} type,
this function and the associated GWGLM series uniquely support proportion-type responses
expressed as success counts and total trials (e.g., \code{y/n}).

When success/trial matrices are provided, the function automatically computes the success proportions internally,
eliminating the need for manual preprocessing.

This feature broadens the flexibility of modeling binary and proportion data,
addressing a common limitation in existing geographically weighted modeling packages.
}
\examples{
\dontrun{
data(tokyo)

tokyo[,6:9] <- scale(tokyo[,6:9])
tokyo$lnoff = log(tokyo$Exp_2564)

cordxy <- cbind(tokyo$X, tokyo$Y)
formula <- Mort2564~Professl+OwnHome+Elderly+Unemply+offset(lnoff)
family <- "poisson"
offset <- "lnoff"
local_var <- c("Professl","Unemply")
global_var <- c("(Intercept)","OwnHome","Elderly")

ts_bw_cv <- tsbw_gwglm(
  formula = formula,
  family = family,
  cordxy = cordxy,
  kernel = "gaussian",
  adaptive = FALSE,
  criterion = "CV",
  offset = offset,
  local_var = local_var,
  global_var = global_var,
  data = tokyo,
  parallel = TRUE
)
ts_bw_cv

TSGWML_result <- TSGWML(
  formula = formula,
  family = family,
  cordxy = cordxy,
  kernel = "gaussian",
  adaptive = FALSE,
  h1 = ts_bw_cv$h1,
  h2 = ts_bw_cv$h2,
  offset = offset,
  local_var = local_var,
  global_var = global_var,
  data = tokyo,
  parallel = TRUE
)
TSGWML_result
}
}
\references{
Li, D. and Mei, C. (2018). A two-stage estimation method with bootstrap inference for semi-parametric geographically weighted generalized linear models.
International Journal of Geographical Information Science, 32(9):1860â€“1883.

Zheng, G.-T. (2024). \emph{An application of semi-parametric geographically weighted logistic regression in real estate transaction data analysis}.
Master's thesis, Department of Statistics, National Chengchi University, Taiwan.
}
